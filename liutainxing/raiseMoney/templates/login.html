{% extends 'base.html' %}
{% load staticfiles %}

{% block log_reg %}
{% endblock %}
{% block end %}
{% endblock %}
{% block content %}
    <link rel="stylesheet" href="/static/css/login.css">
    <div class="container">

        <form class="form-signin" role="form" action="{% url 'user:login' %}" method="post">
            <h2 class="form-signin-heading"><i class="glyphicon glyphicon-log-in"></i> 用户登录</h2>
            <div class="form-group has-success has-feedback">
                <input type="text" class="form-control" id="username" placeholder="请输入登录账号" autofocus name="username">
                <span class="glyphicon glyphicon-user form-control-feedback"></span>
            </div>
            <div class="form-group has-success has-feedback">
                <input type="text" class="form-control" id="pwd" placeholder="请输入登录密码" style="margin-top:10px;"
                       name="password">
                <span class="glyphicon glyphicon-lock form-control-feedback"></span>
            </div>
            <div class="form-group has-success has-feedback">
                <select class="form-control" name="types">
                    <option value="member">会员</option>
                    <option value="user">管理</option>
                </select>
            </div>
            <div class="checkbox">
                <label>
                    <input type="checkbox" value="remember-me"> 记住我
                </label>
                <br>
                <label>
                    忘记密码
                </label>
                <label style="float:right">
                    <a href="{% url 'user:reg' %}">我要注册</a>
                </label>
            </div>
            <input class="btn btn-lg btn-success btn-block" id="btnLogin" value="登录" type="submit">
            {% csrf_token %}
            {% for key,value in login_form.errors.items %}
                {{ value }}
            {% endfor %}
        {% if  not login_form.errors  %}{{ error }}{% endif %}
        </form>
    </div>
{% endblock %}
<script src="{% static  'jquery/jquery-2.1.1.min.js' %}"></script>
<script src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>
<script>
    {#    function dologin() {#}
    {#        var type = $(":selected").val();#}
    {#        if ( type == "user" ) {#}
    {#            window.location.href = "main.html";#}
    {#        } else {#}
    {#            window.location.href = "{% url 'index' %}";#}
    {#        }#}
    {#    }#}
    {#     $(function () {#}
    {#            $('#btnLogin').click(function () {#}
    {#                // 获取用户名和密码#}
    {#                username = $('#username').val()#}
    {#                password = $('#pwd').val()#}
    {#                csrf = $('input[name="csrfmiddlewaretoken"]').val()#}
    {#                remember = $('input[name="remember"]').prop('checked')#}
    {#                // 发起ajax请求#}
    {#                params = {'username':username, 'password':password,#}
    {#                        'csrfmiddlewaretoken':csrf, 'remember':remember}#}
    {#                $.post('/user/login/', params, function (data) {#}
    {#                    // 用户名密码错误 {'res': 0}#}
    {#                    // 登录成功 {'res': 1}#}
    {#                    if (data.res == 0){#}
    {#                        $('#username').next().html('用户名或密码错误').show()#}
    {#                    }#}
    {#                    else#}
    {#                    {#}
    {#                        // 跳转页面#}
    {#                        location.href = data.next_url // /user/#}
    {#                    }#}
    {#                })#}
    {#            })#}
    {#        })#}
</script>
</body>
</html>